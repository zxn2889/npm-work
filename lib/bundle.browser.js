!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).achieve={})}(this,(function(e){"use strict";let t,r=[];function o(e,o={}){const s=()=>{n(s),t=s,r.push(t);const o=e();return r.pop(),t=r.at(-1),o};return s.options=o,s.deps=[],o.lazy||s(),s}const n=e=>{for(let t=0;t<e.deps.length;t++){e.deps[t].delete(e)}e.deps.length=0},s={};["includes","indexOf","lastIndexOf"].forEach((e=>{const t=Array.prototype[e];s[e]=function(...e){let r=t.apply(this,e);return r||(r=t.apply(this.raw,e)),r}}));let c=!1;const l={};["push","pop","shift","unshift","splice"].forEach((e=>{const t=Array.prototype[e];l[e]=function(...e){c=!0;const r=t.apply(this,e);return c=!1,r}}));let f=new WeakMap,a=Symbol();const u="ADD",i="SET",p="DEL",y="length",h=(e=!1,t=!1)=>({get(r,o,n){if(console.log("get:",o),"raw"===o)return r;if(Array.isArray(r)&&s.hasOwnProperty(o))return Reflect.get(s,o,n);if(Array.isArray(r)&&l.hasOwnProperty(o))return Reflect.get(l,o,n);t||"symbol"==typeof o||d(r,o);const c=Reflect.get(r,o,n);return e?c:"object"==typeof c&&null!==c?t?b(c):A(c):c},set(e,r,o,n){if(console.log("set:",r),t)return console.warn("当前为只读对象，不可编辑！"),!1;const s=e[r],c=Array.isArray(e)?Number(r)>e[y]-1?u:i:Object.prototype.hasOwnProperty.call(e,r)?i:u,l=Reflect.set(e,r,o,n);return e===n.raw&&(s===o||s!=s&&o!=o||g(e,r,c,o)),l},has:(e,t)=>(d(e,t),Reflect.has(e,t)),deleteProperty(e,r){if(t)return console.warn("当前为只读对象，不可删除！"),!1;const o=Object.prototype.hasOwnProperty.call(e,r),n=Reflect.deleteProperty(e,r);return o&&n&&g(e,r,p),n},ownKeys(e){const t=Array.isArray(e)?y:a;return d(e,t),Reflect.ownKeys(e)}}),d=(e,r)=>{if(!t||c)return e[r];let o=f.get(e);o||f.set(e,o=new Map);let n=o.get(r);n||o.set(r,n=new Set),n.add(t),t.deps.push(n)},g=(e,r,o,n)=>{console.log("type",o);const s=f.get(e);if(!s)return;const c=s.get(r),l=new Set,i=e=>{e&&e.forEach((e=>{e!==t&&l.add(e)}))};if(i(c),o===u||o===p){const e=s.get(a);i(e)}if(o===u&&Array.isArray(e)){console.log("01");const e=s.get(y);i(e)}Array.isArray(e)&&r===y&&(console.log("02"),s.forEach(((e,t)=>{t>=n&&i(e)}))),l.forEach((e=>{e.options.scheduler?e.options.scheduler(e):e()}))};function w(e,t=!1,r=!1){return new Proxy(e,h(t,r))}let R=new Map;function A(e){const t=R.get(e);if(t)return t;const r=w(e);return R.set(e,r),r}function b(e){return w(e,!1,!0)}const v=(e,t)=>{const r={get value(){return e[t]},set value(r){e[t]=r}};return Object.defineProperty(r,"__v_isRef",{value:!0}),console.log("wrapper",r),r},O=e=>{let t={};return Object.keys(e).forEach((r=>{t[r]=v(e,r)})),t},_=e=>new Proxy(e,{get(e,t,r){const o=Reflect.get(e,t,r);return o.__v_isRef?o.value:o},set(e,t,r,o){const n=e[t];return n.__v_isRef?(n.value=r,!0):Reflect.set(e,t,r,o)}});let P=A({foo:1,bar:2});const j=_({...O(P)});o((()=>{console.log("nObj",j.foo)})),P.foo=2,j.foo=3,e.effect=o,e.proxyRef=_,e.reactive=A,e.readOnly=b,e.ref=e=>{const t={value:e};return Object.defineProperty(t,"__v_isRef",{value:!0}),A(t)},e.shallowReactive=function(e){return w(e,!0)},e.shallowReadOnly=function(e){return w(e,!0,!0)},e.toRef=v,e.toRefs=O}));
