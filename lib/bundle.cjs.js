"use strict";let e,t=[];const r=e=>{for(let t=0;t<e.deps.length;t++){e.deps[t].delete(e)}e.deps.length=0},o={};["includes","indexOf","lastIndexOf"].forEach((e=>{const t=Array.prototype[e];o[e]=function(...e){let r=t.apply(this,e);return r||(r=t.apply(this.raw,e)),r}}));let n=!1;const s={};["push","pop","shift","unshift","splice"].forEach((e=>{const t=Array.prototype[e];s[e]=function(...e){n=!0;const r=t.apply(this,e);return n=!1,r}}));let c=new WeakMap,l=Symbol();const a="ADD",p="SET",f="DEL",u="length",i=(e=!1,t=!1)=>({get(r,n,c){if(console.log("get:",n),"raw"===n)return r;if(Array.isArray(r)&&o.hasOwnProperty(n))return Reflect.get(o,n,c);if(Array.isArray(r)&&s.hasOwnProperty(n))return Reflect.get(s,n,c);t||"symbol"==typeof n||y(r,n);const l=Reflect.get(r,n,c);return e?l:"object"==typeof l&&null!==l?t?R(l):w(l):l},set(e,r,o,n){if(console.log("set:",r),t)return console.warn("当前为只读对象，不可编辑！"),!1;const s=e[r],c=Array.isArray(e)?Number(r)>e[u]-1?a:p:Object.prototype.hasOwnProperty.call(e,r)?p:a,l=Reflect.set(e,r,o,n);return e===n.raw&&(s===o||s!=s&&o!=o||h(e,r,c,o)),l},has:(e,t)=>(y(e,t),Reflect.has(e,t)),deleteProperty(e,r){if(t)return console.warn("当前为只读对象，不可删除！"),!1;const o=Object.prototype.hasOwnProperty.call(e,r),n=Reflect.deleteProperty(e,r);return o&&n&&h(e,r,f),n},ownKeys(e){const t=Array.isArray(e)?u:l;return y(e,t),Reflect.ownKeys(e)}}),y=(t,r)=>{if(!e||n)return t[r];let o=c.get(t);o||c.set(t,o=new Map);let s=o.get(r);s||o.set(r,s=new Set),s.add(e),e.deps.push(s)},h=(t,r,o,n)=>{console.log("type",o);const s=c.get(t);if(!s)return;const p=s.get(r),i=new Set,y=t=>{t&&t.forEach((t=>{t!==e&&i.add(t)}))};if(y(p),o===a||o===f){const e=s.get(l);y(e)}if(o===a&&Array.isArray(t)){console.log("01");const e=s.get(u);y(e)}Array.isArray(t)&&r===u&&(console.log("02"),s.forEach(((e,t)=>{t>=n&&y(e)}))),i.forEach((e=>{e.options.scheduler?e.options.scheduler(e):e()}))};function g(e,t=!1,r=!1){return new Proxy(e,i(t,r))}let d=new Map;function w(e){const t=d.get(e);if(t)return t;const r=g(e);return d.set(e,r),r}function R(e){return g(e,!1,!0)}const A=(e,t)=>{const r={get value(){return e[t]},set value(r){e[t]=r}};return Object.defineProperty(r,"__v_isRef",{value:!0}),console.log("wrapper",r),r};exports.effect=function(o,n={}){const s=()=>{r(s),e=s,t.push(e);const n=o();return t.pop(),e=t.at(-1),n};return s.options=n,s.deps=[],n.lazy||s(),s},exports.proxyRef=e=>new Proxy(e,{get(e,t,r){const o=Reflect.get(e,t,r);return o.__v_isRef?o.value:o},set(e,t,r,o){const n=e[t];return n.__v_isRef?(n.value=r,!0):Reflect.set(e,t,r,o)}}),exports.reactive=w,exports.readOnly=R,exports.ref=e=>{const t={value:e};return Object.defineProperty(t,"__v_isRef",{value:!0}),w(t)},exports.shallowReactive=function(e){return g(e,!0)},exports.shallowReadOnly=function(e){return g(e,!0,!0)},exports.toRef=A,exports.toRefs=e=>{let t={};return Object.keys(e).forEach((r=>{t[r]=A(e,r)})),t};
