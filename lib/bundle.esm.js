let e,t=[];function r(r,o={}){const s=()=>{n(s),e=s,t.push(e);const o=r();return t.pop(),e=t.at(-1),o};return s.options=o,s.deps=[],o.lazy||s(),s}const n=e=>{for(let t=0;t<e.deps.length;t++){e.deps[t].delete(e)}e.deps.length=0},o={};["includes","indexOf","lastIndexOf"].forEach((e=>{const t=Array.prototype[e];o[e]=function(...e){let r=t.apply(this,e);return r||(r=t.apply(this.raw,e)),r}}));let s=!1;const c={};["push","pop","shift","unshift","splice"].forEach((e=>{const t=Array.prototype[e];c[e]=function(...e){s=!0;const r=t.apply(this,e);return s=!1,r}}));let l=new WeakMap,a=Symbol();const u="ADD",p="SET",f="DEL",i="length",y=(e=!1,t=!1)=>({get(r,n,s){if(console.log("get:",n),"raw"===n)return r;if(Array.isArray(r)&&o.hasOwnProperty(n))return Reflect.get(o,n,s);if(Array.isArray(r)&&c.hasOwnProperty(n))return Reflect.get(c,n,s);t||"symbol"==typeof n||h(r,n);const l=Reflect.get(r,n,s);return e?l:"object"==typeof l&&null!==l?t?_(l):A(l):l},set(e,r,n,o){if(console.log("set:",r),t)return console.warn("当前为只读对象，不可编辑！"),!1;const s=e[r],c=Array.isArray(e)?Number(r)>e[i]-1?u:p:Object.prototype.hasOwnProperty.call(e,r)?p:u,l=Reflect.set(e,r,n,o);return e===o.raw&&(s===n||s!=s&&n!=n||g(e,r,c,n)),l},has:(e,t)=>(h(e,t),Reflect.has(e,t)),deleteProperty(e,r){if(t)return console.warn("当前为只读对象，不可删除！"),!1;const n=Object.prototype.hasOwnProperty.call(e,r),o=Reflect.deleteProperty(e,r);return n&&o&&g(e,r,f),o},ownKeys(e){const t=Array.isArray(e)?i:a;return h(e,t),Reflect.ownKeys(e)}}),h=(t,r)=>{if(!e||s)return t[r];let n=l.get(t);n||l.set(t,n=new Map);let o=n.get(r);o||n.set(r,o=new Set),o.add(e),e.deps.push(o)},g=(t,r,n,o)=>{console.log("type",n);const s=l.get(t);if(!s)return;const c=s.get(r),p=new Set,y=t=>{t&&t.forEach((t=>{t!==e&&p.add(t)}))};if(y(c),n===u||n===f){const e=s.get(a);y(e)}if(n===u&&Array.isArray(t)){console.log("01");const e=s.get(i);y(e)}Array.isArray(t)&&r===i&&(console.log("02"),s.forEach(((e,t)=>{t>=o&&y(e)}))),p.forEach((e=>{e.options.scheduler?e.options.scheduler(e):e()}))};function d(e,t=!1,r=!1){return new Proxy(e,y(t,r))}let w=new Map;function A(e){const t=w.get(e);if(t)return t;const r=d(e);return w.set(e,r),r}function R(e){return d(e,!0)}function _(e){return d(e,!1,!0)}function v(e){return d(e,!0,!0)}const O=e=>{const t={value:e};return Object.defineProperty(t,"__v_isRef",{value:!0}),A(t)},P=(e,t)=>{const r={get value(){return e[t]},set value(r){e[t]=r}};return Object.defineProperty(r,"__v_isRef",{value:!0}),console.log("wrapper",r),r},b=e=>{let t={};return Object.keys(e).forEach((r=>{t[r]=P(e,r)})),t},E=e=>new Proxy(e,{get(e,t,r){const n=Reflect.get(e,t,r);return n.__v_isRef?n.value:n},set(e,t,r,n){const o=e[t];return o.__v_isRef?(o.value=r,!0):Reflect.set(e,t,r,n)}});export{r as effect,E as proxyRef,A as reactive,_ as readOnly,O as ref,R as shallowReactive,v as shallowReadOnly,P as toRef,b as toRefs};
